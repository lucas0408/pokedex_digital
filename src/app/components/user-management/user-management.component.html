<div class="user-management-container">
  <!-- CabeÃ§alho -->
   <nav class="battle-nav">
    <button class="back-button" (click)="goToListPokemon()">
      â† Voltar
    </button>
  </nav>
  <header class="user-management-header">
    <h1>ğŸ‘¥ Gerenciamento de UsuÃ¡rios</h1>
    <p>Gerencie todos os usuÃ¡rios cadastrados na plataforma. Altere permissÃµes e visualize estatÃ­sticas.</p>
    
    <div class="stats">
      <div class="stat-card">
        <strong>{{ usuarios.length }}</strong>
        <br />
        <span>UsuÃ¡rios</span>
      </div>
      <div class="stat-card">
        <strong>{{ getAdminCount() }}</strong>
        <br />
        <span>Administradores</span>
      </div>
      <div class="stat-card">
        <strong>{{ getTotalPokemons() }}</strong>
        <br />
        <span>PokÃ©mon Total</span>
      </div>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner-large"></div>
    <p>Carregando usuÃ¡rios...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage && !loading" class="error-banner">
    <span class="error-icon">âš ï¸</span>
    {{ errorMessage }}
    <button class="close-btn" (click)="errorMessage = ''">âœ•</button>
  </div>

  <!-- Users Table -->
  <div class="table-container" *ngIf="!loading && usuarios.length > 0">
    <div class="table-header">
      <h2>ğŸ“‹ Lista de UsuÃ¡rios</h2>
      <div class="table-actions">
        <input 
          type="text" 
          placeholder="ğŸ” Buscar usuÃ¡rio..."
          [(ngModel)]="searchTerm"
          (input)="filterUsers()"
          class="search-input"
        />
      </div>
    </div>

    <div class="table-wrapper">
      <table class="users-table">
        <thead>
          <tr>
            <th>#</th>
            <th>ğŸ‘¤ Nome</th>
            <th>ğŸ® Login</th>
            <th>ğŸ“§ E-mail</th>
            <th>ğŸ”‘ PermissÃ£o</th>
            <th>âšª PokÃ©mon</th>
            <th>ğŸ“… Cadastro</th>
            <th>âš™ï¸ AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let usuario of filteredUsuarios; let i = index" class="user-row">
            <td class="user-id">{{ usuario.id }}</td>
            
            <td class="user-name">
              <div class="name-cell">
                <div class="avatar">{{ getInitials(usuario.nome) }}</div>
                <span>{{ usuario.nome }}</span>
              </div>
            </td>
            
            <td class="user-login">
              <span class="badge badge-secondary">{{ usuario.login }}</span>
            </td>
            
            <td class="user-email">{{ usuario.email }}</td>
            
            <td class="user-role">
              <select 
                [(ngModel)]="usuario.role" 
                (change)="changeRole(usuario, usuario.role)"
                [class]="'role-select role-' + usuario.role"
              >
                <option value="user">ğŸ‘¤ User</option>
                <option value="admin">ğŸ‘‘ Admin</option>
              </select>
            </td>
            
            <td class="user-pokemons">
              <span class="pokemon-count">{{ usuario.total_pokemons || 0 }}</span>
            </td>
            
            <td class="user-date">
              {{ usuario.dt_inclusao | date:'dd/MM/yyyy' }}
            </td>
            
            <td class="user-actions">
              <button 
                class="btn-delete" 
                (click)="confirmDelete(usuario)"
                title="Excluir usuÃ¡rio"
              >
                ğŸ—‘ï¸
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination (se necessÃ¡rio) -->
    <div class="table-footer">
      <p>Mostrando {{ filteredUsuarios.length }} de {{ usuarios.length }} usuÃ¡rios</p>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && usuarios.length === 0" class="empty-state">
    <div class="empty-icon">ğŸ‘¥</div>
    <h2>Nenhum usuÃ¡rio encontrado</h2>
    <p>NÃ£o hÃ¡ usuÃ¡rios cadastrados no sistema.</p>
  </div>
</div>

<!-- Modal de ConfirmaÃ§Ã£o -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>âš ï¸ Confirmar ExclusÃ£o</h3>
      <button class="close-modal" (click)="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <p>Deseja realmente excluir o usuÃ¡rio <strong>{{ userToDelete?.nome }}</strong>?</p>
      <p class="warning-text">Esta aÃ§Ã£o nÃ£o pode ser desfeita!</p>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeModal()">Cancelar</button>
      <button class="btn-confirm-delete" (click)="deleteUser()">Excluir</button>
    </div>
  </div>
</div>